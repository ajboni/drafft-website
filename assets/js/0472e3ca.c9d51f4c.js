"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2868],{1488:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"reference/multiuser","title":"Drafft Multiuser Feature","description":"Realtime multi user scripting and dialogue trees, with replication to a remote database.","source":"@site/docs/02-reference/70__multiuser.md","sourceDirName":"02-reference","slug":"/reference/multiuser","permalink":"/docs/reference/multiuser","draft":false,"unlisted":false,"editUrl":"https://github.com/ajboni/drafft-website/edit/main/docs/02-reference/70__multiuser.md","tags":[],"version":"current","sidebarPosition":70,"frontMatter":{"title":"Drafft Multiuser Feature","description":"Realtime multi user scripting and dialogue trees, with replication to a remote database.","caption":"Multi user feature"},"sidebar":"tutorialSidebar","previous":{"title":"Kanban Boards","permalink":"/docs/reference/kanban"},"next":{"title":"API Documentation","permalink":"/docs/reference/api"}}');var r=s(4848),a=s(8453);const i={title:"Drafft Multiuser Feature",description:"Realtime multi user scripting and dialogue trees, with replication to a remote database.",caption:"Multi user feature"},o="Multi-user (Remote replication)",c={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Setting up a Remote CouchDB Server for Drafft",id:"setting-up-a-remote-couchdb-server-for-drafft",level:2},{value:"Step 1: Deploy CouchDB with Docker",id:"step-1-deploy-couchdb-with-docker",level:3},{value:"Step 2. Set Up Reverse Proxy (Optional)",id:"step-2-set-up-reverse-proxy-optional",level:3},{value:"Step 3. Enable CORS for Browser-Based Access",id:"step-3-enable-cors-for-browser-based-access",level:3},{value:"Restart CouchDB",id:"restart-couchdb",level:3},{value:"Access CouchDB Admin UI",id:"access-couchdb-admin-ui",level:3},{value:"Choosing How to Configure Remote Sync",id:"choosing-how-to-configure-remote-sync",level:2},{value:"Option 1 \u2014 <strong>Easy Mode: Let Drafft Create the Database</strong>",id:"option-1--easy-mode-let-drafft-create-the-database",level:3},{value:"Option 2 \u2014 <strong>Advanced Mode: Create the Database &amp; User Manually</strong>",id:"option-2--advanced-mode-create-the-database--user-manually",level:3},{value:"1. Create a database",id:"1-create-a-database",level:4},{value:"2. Create a dedicated database user",id:"2-create-a-dedicated-database-user",level:4},{value:"3. Assign permissions",id:"3-assign-permissions",level:4},{value:"4. Configure Drafft",id:"4-configure-drafft",level:4},{value:"Drafft Integration Requirements",id:"drafft-integration-requirements",level:2},{value:"Database URL:",id:"database-url",level:3},{value:"Database Name",id:"database-name",level:3},{value:"Examples:",id:"examples",level:4},{value:"Sync issues",id:"sync-issues",level:2},{value:"Notes",id:"notes",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"multi-user-remote-replication",children:"Multi-user (Remote replication)"})}),"\n",(0,r.jsxs)(n.p,{children:["With the power of ",(0,r.jsx)(n.a,{href:"https://couchdb.apache.org/",children:"Apache CouchDB"}),", Drafft supports realtime multiuser sync to a remote database."]}),"\n",(0,r.jsx)(n.p,{children:"Every time a user make a change it will sync the changes to the remote server. Now each client will poll this server for changes in \u201cRemote sync interval\u201d seconds, merging the changes on their local database."}),"\n",(0,r.jsx)(n.p,{children:"That\u2019s why the lock/unlock mechanism was added. We can replicate in real-time, but with the condition that no 2 users are modifying the same item to prevent conflicts and data loss."}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.a,{href:"https://couchdb.apache.org/",children:"couchdb"})," server, with admin permissions. A dedicated server for drafft is recommended. The easiest way to get it running is using the ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/_/couchdb/",children:"official docker image"})]}),"\n",(0,r.jsx)(n.li,{children:"Connectivity of each computer to the server."}),"\n",(0,r.jsx)(n.li,{children:"Each user should have a distinctive username"}),"\n",(0,r.jsx)(n.li,{children:"Each user should enable the remote sync feature in the project settings, and input the server url and database name."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-a-remote-couchdb-server-for-drafft",children:"Setting up a Remote CouchDB Server for Drafft"}),"\n",(0,r.jsx)(n.p,{children:"Drafft supports remote synchronization with a CouchDB-compatible server. This guide walks you through deploying CouchDB using Docker, enabling CORS for browser access, and preparing your server for integration with Drafft."}),"\n",(0,r.jsx)(n.p,{children:"To deploy CouchDB using Docker, follow these steps:"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-deploy-couchdb-with-docker",children:"Step 1: Deploy CouchDB with Docker"}),"\n",(0,r.jsx)(n.p,{children:"Create a file named docker-compose.yml:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'services:\n  couchdb:\n    image: couchdb:latest\n    container_name: drafft-couchdb\n    restart: unless-stopped\n    ports:\n      - "5984:5984" # (Optional) Expose CouchDB on port 5984\n    environment:\n      - COUCHDB_USER=admin\n      - COUCHDB_PASSWORD=secret_please_change\n    volumes:\n      - couchdb-data:/opt/couchdb/data\n\nvolumes:\n  couchdb-data:\n\n# Optional: Connect to the proxy network Instead of exposing ports\nnetworks:\n  default:\n    name: proxy-net\n    external: true\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"\ud83d\udca1 Drafft recommends using a Docker volume for persistence. For advanced users, a bind mount may be used to access the database files directly."})}),"\n",(0,r.jsx)(n.p,{children:"Start the container:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"docker compose up -d"})}),"\n",(0,r.jsx)(n.p,{children:"This will launch CouchDB internally on port 5984, connected to your existing Docker reverse proxy network (e.g., with Nginx Proxy Manager)."}),"\n",(0,r.jsx)(n.h3,{id:"step-2-set-up-reverse-proxy-optional",children:"Step 2. Set Up Reverse Proxy (Optional)"}),"\n",(0,r.jsx)(n.p,{children:"If you're using Nginx Proxy Manager (or Caddy, etc.), point a subdomain like couch.drafft.dev to the internal service drafft-couchdb:5984."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure ports 5984 are not exposed publicly."}),"\n",(0,r.jsx)(n.li,{children:"Use HTTPS for production."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Ensure ",(0,r.jsx)(n.code,{children:"client_max_body_size"})," is set high enough in your reverse proxy to accommodate large document uploads. Otherwise you may encounter errors when syncing large files (413 Request Entity Too Large)."]})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-enable-cors-for-browser-based-access",children:"Step 3. Enable CORS for Browser-Based Access"}),"\n",(0,r.jsx)(n.p,{children:"To allow Drafft to sync from a browser, enable Cross-Origin Resource Sharing (CORS):"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"This is can be done via the CouchDB Admin UI. For advanced users, you can also use the command line."})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"CORS",src:s(2761).A+"",width:"1272",height:"653"})}),"\n",(0,r.jsx)(n.h3,{id:"restart-couchdb",children:"Restart CouchDB"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"docker restart drafft-couchdb"})}),"\n",(0,r.jsx)(n.h3,{id:"access-couchdb-admin-ui",children:"Access CouchDB Admin UI"}),"\n",(0,r.jsxs)(n.p,{children:["You can access the CouchDB Admin UI at ",(0,r.jsx)(n.a,{href:"http://localhost:5984/%5C_utils",children:"http://localhost:5984/\\_utils"})," or via your reverse proxy URL (e.g., ",(0,r.jsx)(n.a,{href:"https://couch.drafft.dev/_utils",children:"https://couch.drafft.dev/_utils"}),")."]}),"\n",(0,r.jsx)(n.h2,{id:"choosing-how-to-configure-remote-sync",children:"Choosing How to Configure Remote Sync"}),"\n",(0,r.jsx)(n.p,{children:"Drafft supports two ways of setting up the remote CouchDB database. Choose the approach that fits your workflow and security requirements."}),"\n",(0,r.jsxs)(n.h3,{id:"option-1--easy-mode-let-drafft-create-the-database",children:["Option 1 \u2014 ",(0,r.jsx)(n.strong,{children:"Easy Mode: Let Drafft Create the Database"})]}),"\n",(0,r.jsxs)(n.p,{children:["If you use your ",(0,r.jsx)(n.strong,{children:"CouchDB admin account"}),", Drafft can automatically create the project database the first time you enter your sync settings."]}),"\n",(0,r.jsx)(n.p,{children:"Open:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Project Settings \u2192 Remote Replication \u2192 Sync with remote DB"})}),"\n",(0,r.jsx)(n.p,{children:"Fill in:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Server URL"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Admin username + password"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Desired database name"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Drafft will:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check if the database exists"}),"\n",(0,r.jsx)(n.li,{children:"Create it if it doesn\u2019t"}),"\n",(0,r.jsx)(n.li,{children:"Set basic permissions automatically"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Recommended for",type:"note",children:(0,r.jsx)(n.p,{children:"Small teams, prototypes, and setups where granular security is not required."})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"option-2--advanced-mode-create-the-database--user-manually",children:["Option 2 \u2014 ",(0,r.jsx)(n.strong,{children:"Advanced Mode: Create the Database & User Manually"})]}),"\n",(0,r.jsx)(n.p,{children:"If you prefer tighter control, don\u2019t want users to rely on an admin account, or want to configure custom permissions, this method is for you."}),"\n",(0,r.jsx)(n.p,{children:"You can follow these steps either through Fauxton or the CouchDB HTTP API."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"1-create-a-database",children:"1. Create a database"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example database name:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"drafft_2_quantum_empanada\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fauxton:"}),"\n",(0,r.jsx)(n.strong,{children:"Create Database \u2192 drafft_2_quantum_empanada"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"HTTP API:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"PUT /drafft_2_quantum_empanada\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"2-create-a-dedicated-database-user",children:"2. Create a dedicated database user"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fauxton:"}),"\n",(0,r.jsx)(n.strong,{children:"Database \u2192 _users \u2192 Create Document"})]}),"\n",(0,r.jsx)(n.p,{children:"Paste:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "_id": "org.couchdb.user:drafft_sync_user_01",\n  "name": "drafft_sync_user_01",\n  "type": "user",\n  "roles": [],\n  "password": "super_secret_password"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"HTTP API:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'PUT /_users/org.couchdb.user:drafft_sync_user_01\nContent-Type: application/json\n\n{\n  "name": "drafft_sync_user_01",\n  "type": "user",\n  "roles": [],\n  "password": "super_secret_password"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"user-creation",src:s(3173).A+"",width:"550",height:"360"})}),"\n",(0,r.jsx)(n.h4,{id:"3-assign-permissions",children:"3. Assign permissions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fauxton:"}),"\n",(0,r.jsx)(n.strong,{children:"Database \u2192 drafft_2_quantum_empanada \u2192 Permissions \u2192 Members \u2192 Add User"})]}),"\n",(0,r.jsxs)(n.p,{children:["Add:\n",(0,r.jsx)(n.code,{children:"drafft_sync_user_01"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"HTTP API:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'PUT /drafft_2_quantum_empanada/_security\nContent-Type: application/json\n\n{\n  "members": {\n    "names": ["drafft_sync_user_01"],\n    "roles": []\n  },\n  "admins": {\n    "names": [],\n    "roles": []\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"user-permission",src:s(741).A+"",width:"1913",height:"512"})}),"\n",(0,r.jsx)(n.h4,{id:"4-configure-drafft",children:"4. Configure Drafft"}),"\n",(0,r.jsx)(n.p,{children:"Open:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Project Settings \u2192 Remote Replication"})}),"\n",(0,r.jsx)(n.p,{children:"Enter:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Server URL"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Your created database name"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"The restricted username + password"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Drafft will sync using that user and will not attempt to create or modify any other databases."}),"\n",(0,r.jsx)(n.admonition,{title:"Recommended for",type:"tip",children:(0,r.jsx)(n.p,{children:"Production systems, multi-project servers, and setups requiring least-privilege access."})}),"\n",(0,r.jsx)(n.h2,{id:"drafft-integration-requirements",children:"Drafft Integration Requirements"}),"\n",(0,r.jsx)(n.h3,{id:"database-url",children:"Database URL:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Must begin with http:// or https://"}),"\n",(0,r.jsxs)(n.li,{children:["Example: ",(0,r.jsx)(n.a,{href:"https://couch.drafft.dev",children:"https://couch.drafft.dev"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"database-name",children:"Database Name"}),"\n",(0,r.jsx)(n.p,{children:"Couchdb doesn\u2019t allow capital letters so Drafft does not allow it either (when you create it uppercase the database name will be renamed to lowercase).\nIt is better to avoid spaces and special characters in the name."}),"\n",(0,r.jsx)(n.p,{children:"The database name must:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Start with a lowercase letter"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Contain only lowercase letters, numbers, or the symbols _, $, (, ), +, -, /"}),"\n",(0,r.jsx)(n.li,{children:"\u274c No uppercase letters, spaces, or special characters like @, !, etc."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"examples",children:"Examples:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 drafft-sync"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 user_data_01"}),"\n",(0,r.jsx)(n.li,{children:"\u274c UserData (uppercase)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c user data (space)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c user@data (invalid character)"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Caution",type:"danger",children:(0,r.jsx)(n.p,{children:"The database name must be unique for each project. If you try to sync a project with the same name as another one, it will try to sync with the existing database. potentially losing data and conflicting with other users."})}),"\n",(0,r.jsx)(n.h2,{id:"sync-issues",children:"Sync issues"}),"\n",(0,r.jsx)(n.p,{children:"Although the process is simple and it's quite tested, certain networking conditions, or a user working offline, could potentially overwrite another user's work if they work on the same item. It is recommended that the modifications are done when online or that the team organize the workflow to avoid such issues."}),"\n",(0,r.jsxs)(n.p,{children:["In case of conflicts, the app will try its best to choose the ",(0,r.jsx)(n.a,{href:"https://guide.couchdb.org/draft/conflicts.html",children:"winning revision"})," but it is also possible to manually resolve them either in couchdb server with a tool like ",(0,r.jsx)(n.a,{href:"https://couchdb.apache.org/fauxton-visual-guide/index.html",children:"Fauxton"})," or in the app by manually merging the changes. For the latter, revisions are shown in the document info drawer."]}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsx)(n.p,{children:"Remember that making backups is always a good practice."})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All table names will appear as ",(0,r.jsx)(n.code,{children:"drafft_v2_project_name_lowercase"})]}),"\n",(0,r.jsx)(n.li,{children:"CORS must be enabled in couchdb"}),"\n",(0,r.jsx)(n.li,{children:"Database url MUST start with http:// or https://"}),"\n",(0,r.jsxs)(n.li,{children:["The local database is stored in the electron browser storage, it can be accessed with the dev tools via ",(0,r.jsx)(n.code,{children:"indexedDB.databases()"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},741:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/_permissions-da0e5966155faf4ea2e8f94311ab7616.jpg"},3173:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/_users-c31cbc9c64e107aae28f94a4369d4b74.jpg"},2761:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/couch-cors-46fe4a1c28c52653bb1c9a12955b8b50.webp"},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(6540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);